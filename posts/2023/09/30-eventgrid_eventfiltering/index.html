<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Using Azure Event Grid Event Filtering Effectively | Developer Meanderings</title><meta name=description content="Carefully planning your events can bring large benefits later">
<meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Azure Event Grid Event Filtering Effectively"><meta name=twitter:description content="Carefully planning your events can bring large benefits later"><meta property="og:url" content="https://korndoerfer.dev/posts/2023/09/30-eventgrid_eventfiltering/"><meta property="og:site_name" content="Developer Meanderings"><meta property="og:title" content="Using Azure Event Grid Event Filtering Effectively"><meta property="og:description" content="Carefully planning your events can bring large benefits later"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-30T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-30T00:00:00+00:00"><meta property="article:tag" content="Azure"><meta property="article:tag" content="Azure Event Grid"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel="shortcut icon" href=/favicon.png type=image/x-icon><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=icon href=/logo.svg sizes=any type=image/svg+xml></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://korndoerfer.dev/>Developer Meanderings</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/about/ title=About>About</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/azure/ title=Azure>Azure</a>
<a class=tag href=/tags/azure-event-grid/ title="Azure Event Grid">Azure Event Grid</a></div><h1>Using Azure Event Grid Event Filtering Effectively</h1><h2 class=subheading></h2><span class=meta>Posted by
on Sat, Sep 30, 2023</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>Azure Event Grid is a globally distributed, highly scalable Pub/Sub messaging service
that makes building a distributed, event-based system quick and easy. It is integrated
into almost every Azure service allowing you to respond to almost anything that happpens
in Azure. In order to properly leverage this capability and evolve your applications
effectively over time, you need to plan how to filter your messages appropriately.</p><h2 id=event-filtering>Event Filtering<a class=anchorjs-link href=#event-filtering></a></h2><p>At it&rsquo;s most basic Event Grid functions as a messaging clearinghouse&mldr; a mediator
between two or more systems in order to exchange messages without being directly
linked to each other. When your application is small and the number of publishers
is small this works fine, but as your application grows and the number of publishers
grow you need an effective means of only responding to messages that you care about.</p><p>This is where <strong>Event Filtering</strong> becomes crucial and there are two main ways this can
be accomplished. But first, we need to understand the anatomy of an Event Grid message.</p><h3 id=event-grid-events>Event Grid Events<a class=anchorjs-link href=#event-grid-events></a></h3><p>The format for an Event Grid Event is as follows (represented as JSON with required properties highlighted):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-json data-lang=json><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>[
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#f92672>&#34;topic&#34;</span>: <span style=color:#960050;background-color:#1e0010>string</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f92672>&#34;subject&#34;</span>: <span style=color:#960050;background-color:#1e0010>string</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#960050;background-color:#1e0010>string</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#f92672>&#34;eventType&#34;</span>: <span style=color:#960050;background-color:#1e0010>string</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#f92672>&#34;eventTime&#34;</span>: <span style=color:#960050;background-color:#1e0010>string</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#f92672>&#34;data&#34;</span>: {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>      <span style=color:#75715e>// json data unique to each message type
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#75715e></span>    },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#f92672>&#34;dataVersion&#34;</span>: <span style=color:#960050;background-color:#1e0010>string</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#f92672>&#34;metadataVersion&#34;</span>: <span style=color:#960050;background-color:#1e0010>string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>]
</span></span></code></pre></div><p>The <code>subject</code> & <code>eventType</code> properties are what allows you to properly filter
messages down to what your subscriber cares about when you are creating your
Event Grid subscription.</p><h3 id=subject-filtering>Subject filtering<a class=anchorjs-link href=#subject-filtering></a></h3><p>As you could already guess, <strong>subject filters</strong> allows you to filter incoming messages
by looking at the subject field. This is purely a string feild, so you can use any
value that you would like. However, in order to avoid different components in your
system from publishing events with the same subject, you should establish a convention
that prevents this from happening.</p><p>As mentioned above, almost every Azure service publishes events that you can subscribe
to so you can take action when those events occur (like a blob being uploaded or modified).
If we were to simply use <code>Modified</code> as the subject, how would we know that this event
came from a blob storage container or an entity being updated in CosmosDB?</p><p>The convention used by Microsoft for their events is to use a series of tokens
separated by <code>/</code> characters that get more specific the farther right you move. For
example:</p><blockquote><p><code>/blobServices/default/containers/{containername}/blobs/{blobname}</code></p></blockquote><p>This subject starts with a broad token that indicates this event came from <code>blobServices</code>
and then drills down through the containers to a specific blob the farther right we move.</p><p>When filtering on the subject property, you can filter by a starting value, ending
value, or both utilizing <code>subjectStartsWith</code> and <code>subjectEndsWith</code>.</p><p>Continuing with the storage account example above, we could choose to only receive
messages for events where the subject ends in <code>.jpg</code> or messages where the subject
begins with <code>/blobServices/default/containers/profilePictures</code> for events that
happened in the <strong>profilePictures</strong> container (regardless of file type).</p><p>When looking to determine a convention for your own subjects, try to build a path
from least speficic to most specific to allow varying levels of specificity.</p><h3 id=event-types>Event Types<a class=anchorjs-link href=#event-types></a></h3><p>Using the <code>eventType</code> property, we can choose to filter on certain <em>types</em> of messages.
This is usually very helpful since different event tyoes usually have a different
payload in the <code>data</code> property. Again, having a well established convention helps
making filtering more precise.</p><p>A simple but very effective strategy is to use the following format, similar to
namespaces/packages in programming languages:</p><blockquote><p><code>{Company}.{Product}.{Service}.{Action}</code></p></blockquote><p>where:</p><ul><li><code>Company</code> is the name of your company to prevent collisions with messages from
other companies or products you might use.</li><li><code>Product</code> is the top level name of your product. Even if you only have a single
product currently, your might not in the future.</li><li><code>Service</code> is the individual service within the product that is publishing the message.
This is especially helpful when your application is composed of many different
microservices. If it isn&rsquo;t, think about functional areas in your product that making
grouping easier.</li><li><code>Action</code> describes the event that is happening, like <strong>InventoryRestock</strong>, or
<strong>PaymentDeclined</strong>.</li></ul><p>Putting these together could result in and eventType similar to:</p><blockquote><p>Acme.OnlineOrdering.Checkout.OrderPlaced</p></blockquote><p>or</p><blockquote><p>Acme.OnlineOrdering.Inventory.StockPulled</p></blockquote><h2 id=conclusion>Conclusion<a class=anchorjs-link href=#conclusion></a></h2><p>By determining a naming convention for both the <code>subject</code> and the <code>eventType</code>
properties early in the development of your application, you can ensure that as
your application grows so does the ability to control what messages are received
and where they are delivered.</p><h3 id=more-resources>More resources<a class=anchorjs-link href=#more-resources></a></h3><p><a href=https://learn.microsoft.com/en-us/azure/event-grid/event-filtering#event-type-filtering target=_blank>Event-type filtering</a></p><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/2023/03/01-options_pattern/ data-toggle=tooltip data-placement=top title="Using the Options Pattern in .NET">Previous<br><span>Using the Options Pattern in .NET</span></a></li><li class=next><a href=/posts/2024/04/25-notpatternproblems/ data-toggle=tooltip data-placement=top title="C# not pattern pitfall">Next<br><span>C# not pattern pitfall</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/.net/>.NET</a>
<a href=/tags/azure/>Azure</a>
<a href=/tags/azure-event-grid/>Azure Event Grid</a>
<a href=/tags/c%23/>C#</a>
<a href=/tags/cosmosdb/>CosmosDB</a>
<a href=/tags/eventgrid/>EventGrid</a>
<a href=/tags/pattern/>Pattern</a>
<a href=/tags/patterns/>Patterns</a>
<a href=/tags/testing/>Testing</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=https://github.com/KyleKorndoerfer target=_blank><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/KyleKorndoerfer target=_blank><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://hachyderm.io/@kylek target=_blank><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">S. Kyle Korndoerfer<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script src=/zoomjs/zoom.min.js></script></body></html>