<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>C# not pattern pitfall | Developer Meanderings</title><meta name=description content="Be careful when using C# Patterns with the not keyword">
<meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="C# not pattern pitfall"><meta name=twitter:description content="Be careful when using C# Patterns with the not keyword"><meta property="og:url" content="https://korndoerfer.dev/posts/2024/04/25-notpatternproblems/"><meta property="og:site_name" content="Developer Meanderings"><meta property="og:title" content="C# not pattern pitfall"><meta property="og:description" content="Be careful when using C# Patterns with the not keyword"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-25T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-25T00:00:00+00:00"><meta property="article:tag" content=".NET"><meta property="article:tag" content="C#"><meta property="article:tag" content="Pattern"><link rel=stylesheet href=/css/bootstrap.min.css crossorigin=anonymous><link href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/sass/main.css><link rel=stylesheet href=/zoomjs/zoom.min.css><script src=/js/lazysizes.min.js></script><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel="shortcut icon" href=/favicon.png type=image/x-icon><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=icon href=/logo.svg sizes=any type=image/svg+xml></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top invert"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://korndoerfer.dev/>Developer Meanderings</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/ title=Home>Home</a></li><li><a href=/about/ title=About>About</a></li><li class=search-icon><a href=javascript:void(0)><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse"),__HuxNav__={close:function(){$navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)},open:function(){$collapse.style.height="auto",$navbar.className+=" in"}};$toggle.addEventListener("click",function(){$navbar.className.indexOf("in")>0?__HuxNav__.close():__HuxNav__.open()}),document.addEventListener("click",function(e){if(e.target==$toggle)return;if(e.target.className=="icon-bar")return;__HuxNav__.close()})</script><div class=search-page><div class=search-icon-close-container><span class=search-icon-close><i class="fa fa-chevron-down"></i></span></div><div class="search-main container"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><form></form><input type=text id=search-input placeholder="$ grep..."></form><div id=search-results class=mini-post-list></div></div></div></div></div><style type=text/css>header.intro-header{position:relative;background-image:url('')}</style><header class="intro-header style-text"><div class=header-mask></div><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/.net/ title=.NET>.NET</a>
<a class=tag href=/tags/c%23/ title=C#>C#</a>
<a class=tag href=/tags/pattern/ title=Pattern>Pattern</a></div><h1>C# not pattern pitfall</h1><h2 class=subheading></h2><span class=meta>Posted by
on Thu, Apr 25, 2024</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>Using the pattern capabilities in C# can make code more readable and easier
to understand but can come with some pitfalls that could catch you off guard
if you are not careful.</p><h2 id=pattern-power>Pattern power<a class=anchorjs-link href=#pattern-power></a></h2><p>Patterns can be especially useful when used with Enumerations. For example,
given the following enum:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>enum</span> OrderStatus
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    Placed,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    Processing,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    Shipped,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    Delivered
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>OrderStatus orderStatus = OrderStatus.Placed;
</span></span></code></pre></div><p>if you wanted to check if the order status was one of two potential values
without using patterns you would typically do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>if</span> (orderStatus == OrderStatus.Placed || orderStatus == OrderStatus.Processing)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}        
</span></span></code></pre></div><p>but with a pattern, you don&rsquo;t need to repeat the variable that you are checking:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>if</span> (orderStatus <span style=color:#66d9ef>is</span> OrderStatus.Placed or OrderStatus.Processing)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span></code></pre></div><p>This expression is shorter in length and follows a more natural way of reading.
But what if you wanted to check if the order status was <strong>not</strong> one of two
different values?</p><h2 id=with-great-power>With great power&mldr;<a class=anchorjs-link href=#with-great-power></a></h2><p>On the surface, you would right it like this, right?:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>if</span> (orderStatus <span style=color:#66d9ef>is</span> not OrderStatus.Shipped or OrderStatus.Delivered)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span></code></pre></div><p>This compiles and appears to be correct. Wouldn&rsquo;t you naturally assume that you
would enter the body of the <code>if</code> block when the order status <em>is not</em> Shipped or
Delivered? If you run this code with <code>orderStatus = OrderStatus.Shipped</code> you
will skip the body of the if statement&mldr; as expected. However, if you set
<code>orderStatus = OrderStatus.Shipped</code> you <em><strong>will</strong></em> enter the body of the <code>if</code>
block!! But why?</p><h2 id=-comes-great-responsibility>&mldr; comes great responsibility<a class=anchorjs-link href=#-comes-great-responsibility></a></h2><p>The reason is that the C# compiler is actually interpreting the <code>if</code> expression as
if it had been written like this (which can be confirmed with unit tests):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>if</span> (orderStatus <span style=color:#66d9ef>is</span> not OrderStatus.Shipped || orderStatus <span style=color:#66d9ef>is</span> OrderStatus.Delivered)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}    
</span></span></code></pre></div><p>now that you understand that, your first few thoughts might be to try and mess
with the combinations of the <code>is not</code> and <code>and</code>/<code>or</code> keywords but the only
syntax that is going to be valid is to group the conditions being checked inside
of parentheses as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>if</span> (orderStatus <span style=color:#66d9ef>is</span> not (OrderStatus.Shipped or OrderStatus.Delivered))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#75715e>// do something</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span></code></pre></div><p>Once it is written this way, you will only enter the body of the <code>if</code> block when
the order status <em><strong>is not</strong></em> equal to <code>OrderStatus.Shipped</code> or
<code>OrderStatus.Delivered</code>.</p><h2 id=wrap-up>Wrap up<a class=anchorjs-link href=#wrap-up></a></h2><p>This is something that Visual Studio will not currently alert you to unless you
have the <a href=https://www.jetbrains.com/resharper title="ReSharper Visual Studio Plugin" target=_blank>JetBrains ReSharper plugin</a> installed. Fortunately, I was writing
code like this using <a href=https://www.jetbrains.com/rider title="Cross-platform .NET Editor" target=_blank>JetBrains Rider</a> which flagged this issue with the
warning of</p><blockquote><p><em>The pattern is redundant, it does not produce any runtime checks</em></p></blockquote><p>which led me to the description and solution for this problem in the
<a href=https://www.jetbrains.com/help/resharper/PatternIsRedundant.html title="Pattern is Redundant" target=_blank>JetBrains Rider documentation</a>.</p><hr style=visibility:hidden><ul class=pager><li class=previous><a href=/posts/2023/09/30-eventgrid_eventfiltering/ data-toggle=tooltip data-placement=top title="Using Azure Event Grid Event Filtering Effectively">Previous<br><span>Using Azure Event Grid Event Filtering Effectively</span></a></li></ul><hr style=visibility:hidden></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5>FEATURED TAGS</h5><div class=tags><a href=/tags/.net/>.NET</a>
<a href=/tags/azure/>Azure</a>
<a href=/tags/azure-event-grid/>Azure Event Grid</a>
<a href=/tags/c%23/>C#</a>
<a href=/tags/cosmosdb/>CosmosDB</a>
<a href=/tags/eventgrid/>EventGrid</a>
<a href=/tags/pattern/>Pattern</a>
<a href=/tags/patterns/>Patterns</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=https://github.com/KyleKorndoerfer target=_blank><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/KyleKorndoerfer target=_blank><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://hachyderm.io/@kylek target=_blank><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i>
<i class="fab fa-mastodon fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">S. Kyle Korndoerfer<br>Powered by <a href=https://gohugo.io>Hugo</a></p></div></div></div></footer><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js crossorigin=anonymous></script><script src=/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js></script><script src=/js/simple-jekyll-search.min.js></script><script src=/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js></script><script src=/zoomjs/zoom.min.js></script></body></html>